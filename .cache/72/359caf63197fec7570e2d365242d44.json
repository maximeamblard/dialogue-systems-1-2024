{"id":"../node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","dependencies":[{"name":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js.map","includedInParent":true,"mtime":1733074798686},{"name":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/package.json","includedInParent":true,"mtime":1733076065657},{"name":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/package.json","includedInParent":true,"mtime":1733074798686},{"name":"@babel/runtime/helpers/interopRequireDefault","loc":{"line":3,"column":37,"index":52},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/node_modules/@babel/runtime/helpers/interopRequireDefault.js"},{"name":"@babel/runtime/regenerator","loc":{"line":10,"column":50,"index":246},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/node_modules/@babel/runtime/regenerator/index.js"},{"name":"@babel/runtime/helpers/defineProperty","loc":{"line":12,"column":54,"index":333},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/node_modules/@babel/runtime/helpers/defineProperty.js"},{"name":"@babel/runtime/helpers/asyncToGenerator","loc":{"line":14,"column":56,"index":433},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/node_modules/@babel/runtime/helpers/asyncToGenerator.js"},{"name":"base64-arraybuffer","loc":{"line":16,"column":33,"index":512},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/base64-arraybuffer/dist/base64-arraybuffer.es5.js"},{"name":"./buildSSML","loc":{"line":18,"column":48,"index":584},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/buildSSML.js"},{"name":"./isSSML","loc":{"line":20,"column":45,"index":647},"parent":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/fetchSpeechData.js","resolved":"/Users/amblardv5/Nextcloud/2024/dialogue-systems-1-2024/node_modules/web-speech-cognitive-services/lib/SpeechServices/TextToSpeech/isSSML.js"}],"generated":{"js":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _base64Arraybuffer = require(\"base64-arraybuffer\");\n\nvar _buildSSML = _interopRequireDefault(require(\"./buildSSML\"));\n\nvar _isSSML = _interopRequireDefault(require(\"./isSSML\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar DEFAULT_LANGUAGE = 'en-US';\nvar DEFAULT_OUTPUT_FORMAT = 'riff-16khz-16bit-mono-pcm';\nvar DEFAULT_VOICE = 'Microsoft Server Speech Text to Speech Voice (en-US, AriaNeural)';\nvar EMPTY_MP3_BASE64 = 'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nfunction _default(_x) {\n  return _ref2.apply(this, arguments);\n}\n\nfunction _ref2() {\n  _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(_ref) {\n    var deploymentId, fetchCredentials, _ref$lang, lang, _ref$outputFormat, outputFormat, pitch, rate, text, _ref$voice, voice, volume, _yield$fetchCredentia, authorizationToken, region, speechSynthesisHostname, subscriptionKey, ssml, hostname, search, url, res;\n\n    return _regenerator.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            deploymentId = _ref.deploymentId, fetchCredentials = _ref.fetchCredentials, _ref$lang = _ref.lang, lang = _ref$lang === void 0 ? DEFAULT_LANGUAGE : _ref$lang, _ref$outputFormat = _ref.outputFormat, outputFormat = _ref$outputFormat === void 0 ? DEFAULT_OUTPUT_FORMAT : _ref$outputFormat, pitch = _ref.pitch, rate = _ref.rate, text = _ref.text, _ref$voice = _ref.voice, voice = _ref$voice === void 0 ? DEFAULT_VOICE : _ref$voice, volume = _ref.volume;\n\n            if (text) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\", (0, _base64Arraybuffer.decode)(EMPTY_MP3_BASE64));\n\n          case 3:\n            _context.next = 5;\n            return fetchCredentials();\n\n          case 5:\n            _yield$fetchCredentia = _context.sent;\n            authorizationToken = _yield$fetchCredentia.authorizationToken;\n            region = _yield$fetchCredentia.region;\n            speechSynthesisHostname = _yield$fetchCredentia.speechSynthesisHostname;\n            subscriptionKey = _yield$fetchCredentia.subscriptionKey;\n\n            if (!(authorizationToken && subscriptionKey || !authorizationToken && !subscriptionKey)) {\n              _context.next = 14;\n              break;\n            }\n\n            throw new Error('Only \"authorizationToken\" or \"subscriptionKey\" should be set.');\n\n          case 14:\n            if (!(region && speechSynthesisHostname || !region && !speechSynthesisHostname)) {\n              _context.next = 16;\n              break;\n            }\n\n            throw new Error('Only \"region\" or \"speechSynthesisHostnamename\" should be set.');\n\n          case 16:\n            ssml = (0, _isSSML.default)(text) ? text : (0, _buildSSML.default)({\n              lang: lang,\n              pitch: pitch,\n              rate: rate,\n              text: text,\n              voice: voice,\n              volume: volume\n            }); // Although calling encodeURI on hostname does not actually works, it fails faster and safer.\n\n            hostname = speechSynthesisHostname || (deploymentId ? \"\".concat(encodeURI(region), \".voice.speech.microsoft.com\") : \"\".concat(encodeURI(region), \".tts.speech.microsoft.com\"));\n            search = deploymentId ? \"?deploymentId=\".concat(encodeURI(deploymentId)) : '';\n            url = \"https://\".concat(hostname, \"/cognitiveservices/v1\").concat(search);\n            _context.next = 22;\n            return fetch(url, {\n              headers: _objectSpread({\n                'Content-Type': 'application/ssml+xml',\n                'X-Microsoft-OutputFormat': outputFormat\n              }, authorizationToken ? {\n                Authorization: \"Bearer \".concat(authorizationToken)\n              } : {\n                'Ocp-Apim-Subscription-Key': subscriptionKey\n              }),\n              method: 'POST',\n              body: ssml\n            });\n\n          case 22:\n            res = _context.sent;\n\n            if (res.ok) {\n              _context.next = 25;\n              break;\n            }\n\n            throw new Error(\"web-speech-cognitive-services: Failed to syntheis speech, server returned \".concat(res.status));\n\n          case 25:\n            return _context.abrupt(\"return\", res.arrayBuffer());\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _ref2.apply(this, arguments);\n}\n"},"sourceMaps":{"js":{"version":3,"file":"fetchSpeechData.js","names":["DEFAULT_LANGUAGE","DEFAULT_OUTPUT_FORMAT","DEFAULT_VOICE","EMPTY_MP3_BASE64","deploymentId","fetchCredentials","lang","outputFormat","pitch","rate","text","voice","volume","decode","authorizationToken","region","speechSynthesisHostname","subscriptionKey","Error","ssml","isSSML","buildSSML","hostname","encodeURI","search","url","fetch","headers","Authorization","method","body","res","ok","status","arrayBuffer"],"sources":["../../../src/SpeechServices/TextToSpeech/fetchSpeechData.js"],"sourcesContent":["import { decode } from 'base64-arraybuffer';\nimport buildSSML from './buildSSML';\nimport isSSML from './isSSML';\n\nconst DEFAULT_LANGUAGE = 'en-US';\nconst DEFAULT_OUTPUT_FORMAT = 'riff-16khz-16bit-mono-pcm';\nconst DEFAULT_VOICE = 'Microsoft Server Speech Text to Speech Voice (en-US, AriaNeural)';\nconst EMPTY_MP3_BASE64 =\n  'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nexport default async function({\n  deploymentId,\n  fetchCredentials,\n  lang = DEFAULT_LANGUAGE,\n  outputFormat = DEFAULT_OUTPUT_FORMAT,\n  pitch,\n  rate,\n  text,\n  voice = DEFAULT_VOICE,\n  volume\n}) {\n  if (!text) {\n    // If text is empty, play a short audio clip. This allows developers to easily prime the AudioContext object by playing an empty string.\n    return decode(EMPTY_MP3_BASE64);\n  }\n\n  const { authorizationToken, region, speechSynthesisHostname, subscriptionKey } = await fetchCredentials();\n\n  if ((authorizationToken && subscriptionKey) || (!authorizationToken && !subscriptionKey)) {\n    throw new Error('Only \"authorizationToken\" or \"subscriptionKey\" should be set.');\n  } else if ((region && speechSynthesisHostname) || (!region && !speechSynthesisHostname)) {\n    throw new Error('Only \"region\" or \"speechSynthesisHostnamename\" should be set.');\n  }\n\n  const ssml = isSSML(text) ? text : buildSSML({ lang, pitch, rate, text, voice, volume });\n\n  // Although calling encodeURI on hostname does not actually works, it fails faster and safer.\n  const hostname =\n    speechSynthesisHostname ||\n    (deploymentId\n      ? `${ encodeURI(region) }.voice.speech.microsoft.com`\n      : `${ encodeURI(region) }.tts.speech.microsoft.com`);\n  const search = deploymentId ? `?deploymentId=${ encodeURI(deploymentId) }` : '';\n  const url = `https://${ hostname }/cognitiveservices/v1${ search }`;\n\n  const res = await fetch(url, {\n    headers: {\n      'Content-Type': 'application/ssml+xml',\n      'X-Microsoft-OutputFormat': outputFormat,\n      ...(authorizationToken\n        ? {\n            Authorization: `Bearer ${ authorizationToken }`\n          }\n        : {\n            'Ocp-Apim-Subscription-Key': subscriptionKey\n          })\n    },\n    method: 'POST',\n    body: ssml\n  });\n\n  if (!res.ok) {\n    throw new Error(`web-speech-cognitive-services: Failed to syntheis speech, server returned ${ res.status }`);\n  }\n\n  return res.arrayBuffer();\n}\n"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;AAEA,IAAMA,gBAAgB,GAAG,OAAzB;AACA,IAAMC,qBAAqB,GAAG,2BAA9B;AACA,IAAMC,aAAa,GAAG,kEAAtB;AACA,IAAMC,gBAAgB,GACpB,skBADF;;;;;;;kFAGe;IAAA;;IAAA;MAAA;QAAA;UAAA;YACbC,YADa,QACbA,YADa,EAEbC,gBAFa,QAEbA,gBAFa,mBAGbC,IAHa,EAGbA,IAHa,0BAGNN,gBAHM,uCAIbO,YAJa,EAIbA,YAJa,kCAIEN,qBAJF,sBAKbO,KALa,QAKbA,KALa,EAMbC,IANa,QAMbA,IANa,EAObC,IAPa,QAObA,IAPa,oBAQbC,KARa,EAQbA,KARa,2BAQLT,aARK,eASbU,MATa,QASbA,MATa;;YAAA,IAWRF,IAXQ;cAAA;cAAA;YAAA;;YAAA,iCAaJ,IAAAG,yBAAA,EAAOV,gBAAP,CAbI;;UAAA;YAAA;YAAA,OAgB0EE,gBAAgB,EAhB1F;;UAAA;YAAA;YAgBLS,kBAhBK,yBAgBLA,kBAhBK;YAgBeC,MAhBf,yBAgBeA,MAhBf;YAgBuBC,uBAhBvB,yBAgBuBA,uBAhBvB;YAgBgDC,eAhBhD,yBAgBgDA,eAhBhD;;YAAA,MAkBRH,kBAAkB,IAAIG,eAAvB,IAA4C,CAACH,kBAAD,IAAuB,CAACG,eAlB3D;cAAA;cAAA;YAAA;;YAAA,MAmBL,IAAIC,KAAJ,CAAU,+DAAV,CAnBK;;UAAA;YAAA,MAoBDH,MAAM,IAAIC,uBAAX,IAAwC,CAACD,MAAD,IAAW,CAACC,uBApBlD;cAAA;cAAA;YAAA;;YAAA,MAqBL,IAAIE,KAAJ,CAAU,+DAAV,CArBK;;UAAA;YAwBPC,IAxBO,GAwBA,IAAAC,eAAA,EAAOV,IAAP,IAAeA,IAAf,GAAsB,IAAAW,kBAAA,EAAU;cAAEf,IAAI,EAAJA,IAAF;cAAQE,KAAK,EAALA,KAAR;cAAeC,IAAI,EAAJA,IAAf;cAAqBC,IAAI,EAAJA,IAArB;cAA2BC,KAAK,EAALA,KAA3B;cAAkCC,MAAM,EAANA;YAAlC,CAAV,CAxBtB,EA0Bb;;YACMU,QA3BO,GA4BXN,uBAAuB,KACtBZ,YAAY,aACLmB,SAAS,CAACR,MAAD,CADJ,6CAELQ,SAAS,CAACR,MAAD,CAFJ,8BADU,CA5BZ;YAgCPS,MAhCO,GAgCEpB,YAAY,2BAAqBmB,SAAS,CAACnB,YAAD,CAA9B,IAAkD,EAhChE;YAiCPqB,GAjCO,qBAiCWH,QAjCX,kCAiC6CE,MAjC7C;YAAA;YAAA,OAmCKE,KAAK,CAACD,GAAD,EAAM;cAC3BE,OAAO;gBACL,gBAAgB,sBADX;gBAEL,4BAA4BpB;cAFvB,GAGDO,kBAAkB,GAClB;gBACEc,aAAa,mBAAad,kBAAb;cADf,CADkB,GAIlB;gBACE,6BAA6BG;cAD/B,CAPC,CADoB;cAY3BY,MAAM,EAAE,MAZmB;cAa3BC,IAAI,EAAEX;YAbqB,CAAN,CAnCV;;UAAA;YAmCPY,GAnCO;;YAAA,IAmDRA,GAAG,CAACC,EAnDI;cAAA;cAAA;YAAA;;YAAA,MAoDL,IAAId,KAAJ,qFAAwFa,GAAG,CAACE,MAA5F,EApDK;;UAAA;YAAA,iCAuDNF,GAAG,CAACG,WAAJ,EAvDM;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C"}},"error":null,"hash":"df315c357126314b0eadee99fba68edf","cacheData":{"env":{}}}